
确认node IP有调整

在收到pong消息体里，针对解析出来的node信息与自身记录的node信息进行比对。
首先nodeName是节点的唯一标识，类似于节点的身份证，新Redis节点的nodeName一旦生成，终生不变。但是节点的IP与端口号却可以变化，例如该节点因硬件损坏被迫由一台服务器迁移至另一台服务器。
那么如何发现一个节点的地址发生了变化呢？

通过对比自身记录的数据与收到pong里的数据，比较如下字段：
1. nodeName相同，表示是同一个节点；
2. 自身将该节点标记为PFAIL或者FAIL（即自身跟该节点之间的TCP连接有异常，疑似失去联系or已经失去联系）；
3. pong中记录的该节点状态非PFAIL或者非FAIL（即从发送pong消息的节点的视角来看，该节点正常）；
4. 自身记录该节点IP或者Port或者CPort与pong消息里记录的不同（即发送pong消息的节点已经发现该节点已经改变了地址，并且已经跟对方新地址建立了正常连接）；


备节点自动漂移到孤儿主节点下面，以达到集群的高可用性。
选取方式是，每个节点均基于自身记录的集群整体信息为准，遍历每个主节点，当发现有孤儿主节点（当前可用的备节点数目为0 且 该主节点有负责的slot信息 且 该主节点依旧适合迁入），这说明集群里需要进行备节点自动漂移。那么哪个节点漂移呢？每个备节点自身都需要进行检测，当自身处于全集群里含有最多备节点的子集群里，那么这个备节点就需要开启尝试漂移。

备节点从自身视角重新遍历集群里的所有主节点，找到第一个孤儿主节点。这个就作为被挂载的主节点使用。
备节点从自身视角遍历每个主节点，计算每个主节点各自所处的子集群中的备节点个数，当个数是整个集群最多的时候，从中选择出nodename字母序最小的节点，整个节点就是要漂移走的备节点。
如果当前进程就是这个要漂移走的备节点时，则主动将之前找到的被挂载孤儿主节点设置为自己的主节点。

meet 运维人员使用此命令将新节点加入到集群中

ping 对于节点距离上一次收到pong消息时间node_timeout/2,主动发送ping消息

update 本机记录slot对应的节点与收到的消息不同,而且本机slot对应节点纪元比消息中的更新,那么就需要向该消息的发送方发送关于本机里该slot的主节点update信息


备节点在总线上交互的slot槽位图均是其隶属于的主节点槽位图

当本机记录的集群节点node里有空的link时,表示需要进行主动外呼建立TCP连接.
这些node一部分来自于运维通过meet手动添加的,另一部分时周边兄弟节点通过ping消息推送来的新节点

集群组建过程

节点之间心跳监测
通过ping-pong进行检测
如果ping之后,有长达node-timeout/2的时长未收到pong,则释放link,重新建立tcp连接
如果

故障迁移

备节点自动漂移

